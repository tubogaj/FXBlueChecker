<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FXBlue Multi-Account Dashboard</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #0f172a;
  color: #f8fafc;
  margin: 0;
  padding: 20px;
}
h1 { text-align: center; color: #38bdf8; }
.container { max-width: 1000px; margin: 0 auto; }
textarea {
  width: 100%; height: 120px; padding: 10px;
  border-radius: 8px; border: none;
  font-family: monospace;
}
button {
  background: #38bdf8;
  color: #0f172a;
  font-weight: bold;
  padding: 10px 20px;
  border: none; border-radius: 6px;
  cursor: pointer;
  margin-top: 10px;
}
button:hover { background: #0ea5e9; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 25px;
  font-size: 0.95rem;
}
th, td {
  border: 1px solid #334155;
  padding: 10px;
  text-align: center;
}
th {
  background: #1e293b;
  cursor: pointer;
  user-select: none;
}
th:hover { background: #334155; }

.green { color: #22c55e; font-weight: 600; }
.red { color: #ef4444; font-weight: 600; }
small { color: #94a3b8; }
</style>
</head>
<body>
  <div class="container">
    <h1>üìä FXBlue Multi-Account Dashboard</h1>
    <p>Enter one or more FXBlue links (one per line):</p>
    <textarea id="links" placeholder="https://www.fxblue.com/users/example1
https://www.fxblue.com/users/example2"></textarea>
    <button onclick="fetchData()">Check Accounts</button>

    <table id="resultsTable">
      <thead>
        <tr>
          <th onclick="sortTable(0)">Account</th>
          <th onclick="sortTable(1)">Balance</th>
          <th onclick="sortTable(2)">Equity</th>
          <th onclick="sortTable(3)">Profit/Loss</th>
          <th onclick="sortTable(4)">Open Trades</th>
          <th onclick="sortTable(5)">Closed Trades</th>
          <th onclick="sortTable(6)">Win Rate</th>
          <th onclick="sortTable(7)">Margin Level</th>
          <th onclick="sortTable(8)">Drawdown</th>
          <th onclick="sortTable(9)">Last Trade</th>
          <th onclick="sortTable(10)">Software</th>
        </tr>
      </thead>
      <tbody id="resultsBody"></tbody>
    </table>
  </div>

<script>
let currentSort = { col: -1, asc: true };

async function fetchData() {
  const tbody = document.getElementById("resultsBody");
  tbody.innerHTML = `<tr><td colspan="11">Loading...</td></tr>`;
  const links = document.getElementById("links").value.trim().split("\n");
  tbody.innerHTML = "";

  for (const link of links) {
    if (!link) continue;
    const cleanLink = link.trim();
    const username = cleanLink.split("/").pop();

    // ‚úÖ Using AllOrigins proxy to bypass FXBlue CORS restrictions
    const apiUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent("https://www.fxblue.com/api/user/" + username + "/latest")}`;

    try {
      const res = await fetch(apiUrl);
      if (!res.ok) throw new Error("Data not found or blocked");
      const data = await res.json();

      const profitVal = data.gainPct ?? 0;
      const profitColor = profitVal >= 0 ? "green" : "red";

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><a href="${cleanLink}" target="_blank" style="color:#38bdf8;text-decoration:none;">${username}</a></td>
        <td>${data.balance ?? "N/A"}</td>
        <td>${data.equity ?? "N/A"}</td>
        <td class="${profitColor}">${profitVal.toFixed(2)}%</td>
        <td>${data.openTrades ?? "N/A"}</td>
        <td>${data.closedTrades ?? "N/A"}</td>
        <td>${data.winPct ? data.winPct.toFixed(2) + "%" : "N/A"}</td>
        <td>${data.marginLevel ? data.marginLevel + "%" : "N/A"}</td>
        <td>${data.drawdownPct ? data.drawdownPct + "%" : "N/A"}</td>
        <td>${data.lastTradeTime ?? "N/A"}</td>
        <td>${data.strategyName ?? "N/A"}</td>
      `;
      tbody.appendChild(tr);
    } catch (err) {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td colspan="11" style="color:#f87171;">‚ùå ${username} ‚Äî Unable to load data (private or unavailable)</td>`;
      tbody.appendChild(tr);
    }
  }
}

function sortTable(colIndex) {
  const table = document.getElementById("resultsTable");
  const tbody = table.tBodies[0];
  const rows = Array.from(tbody.rows);

  const isAsc = currentSort.col === colIndex ? !currentSort.asc : true;
  currentSort = { col: colIndex, asc: isAsc };

  rows.sort((a, b) => {
    const aText = a.cells[colIndex].innerText.replace(/[^\d.-]/g, "");
    const bText = b.cells[colIndex].innerText.replace(/[^\d.-]/g, "");
    const aNum = parseFloat(aText);
    const bNum = parseFloat(bText);
    if (!isNaN(aNum) && !isNaN(bNum)) {
      return isAsc ? aNum - bNum : bNum - aNum;
    }
    return isAsc
      ? a.cells[colIndex].innerText.localeCompare(b.cells[colIndex].innerText)
      : b.cells[colIndex].innerText.localeCompare(a.cells[colIndex].innerText);
  });

  rows.forEach(r => tbody.appendChild(r));
}
</script>
</body>
</html>
